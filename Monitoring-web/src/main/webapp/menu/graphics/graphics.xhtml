<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
 <script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="http://momentjs.com/downloads/moment.min.js"></script>
<script src="http://momentjs.com/downloads/moment-timezone-with-data-2010-2020.min.js"></script>

    <ui:composition template="/menupage.xhtml" >
        <ui:define name="body">
            <h:form id="mainForm">
                 <h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="15">
                    <p:outputLabel for="meterId" value="Meter:" />
                    <p:selectOneMenu id="meterId" value="#{jsonController.meter}">
                        <f:selectItem itemLabel="#{bundle.AllMessage}" />
                        <f:selectItems value="#{meterController.itemsAvailableSelectOne}"
                                           var="itemMet"
                                           itemValue="#{itemMet}"
                                           itemLabel="#{itemMet.name}"/>
                        <f:ajax event="change" listener="#{jsonController.changeValue}"  immediate="true" execute="@form" render=":GraphicsForm" />
                    </p:selectOneMenu>
                    <p:outputLabel for="pmId" value="Physical Machine" />
                    <p:selectOneMenu id="pmId" value="#{jsonController.pm}"  >
                        <f:selectItem itemLabel="#{bundle.SelectOneMessage}" />
                        <f:selectItems value="#{pmController.itemsAvailableSelectOne}"
                                           var="itemPM"
                                           itemValue="#{itemPM}"
                                           itemLabel="#{itemPM.idPm}"/>
                    <f:ajax event="change" listener="#{jsonController.changeJSON}"  immediate="true" execute="@form" render=":GraphicsForm" />
                    </p:selectOneMenu>
                    <p:outputLabel for="vmId" value="Virtual Machine" />
                    <p:selectOneMenu id="vmId" value="#{jsonController.vm}">
                        <f:selectItem itemLabel="#{bundle.SelectOneMessage}"/>
                        <f:selectItems value="#{vmController.itemsAvailableSelectOne}"
                                           var="itemVM"
                                           itemValue="#{itemVM}"
                                           itemLabel="#{itemVM.name}"/>
                     <f:ajax event="change" listener="#{jsonController.changeJSON}"  immediate="true" execute="@form" render=":GraphicsForm" />
                    </p:selectOneMenu>
                    <p:commandButton actionListener="#{jsonController.changeJSON()}" value="#{bundle.Draw}" update=":GraphicsForm" />

                 </h:panelGrid>
            </h:form>
           <h:form id="GraphicsForm">
        <script id="draw">

            Highcharts.setOptions({
            global: {
                timezone:'Europe/Moscow'
            }});
           Highcharts.chart('GraphicsForm', #{jsonController.json});

           </script>
           </h:form>

        </ui:define>
        </ui:composition>


</html>
